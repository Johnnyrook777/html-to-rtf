<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>EditorPacs</title>
	<base href="/">

	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- include libraries(jQuery, bootstrap) -->
	<link href="http://netdna.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.css" rel="stylesheet">
	<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.js"></script>
	<script src="http://netdna.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.js"></script>

	<!-- include summernote css/js-->
	<!--<link href="http://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.4/summernote.css" rel="stylesheet">-->
	<script src="http://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.4/summernote.js"></script>
	<link rel="icon" type="image/x-icon" href="favicon.ico">
	<script>
		var divHtmlIndex;
		var divHtml;
		var tagName = '';
		var tagContent = '';
		var tagOptions = '';
		var rtfStringHeader = "{\\rtf1\\ansi\\deff1 {\\fonttbl {\\f0 SHOWCARD GOTHIC;}{\\f1 Times New Roman;}}";
		var rtfStringHeaderFooter = '{\\colortbl ;}';
		var rtfStringFooter = "}";
		var rtfStringContent = '';
		var rtfString = '';
		var rtfColorTableContent = '';
		var rtfColorTableHead = '{\\colortbl ;';
		var rtfColorTableFooter = '}';
		var colorList = [
			[2], [
				{ red: '01', green: '55', blue: '77', reference: '\\cf1'},
				{ red: '59', green: '0', blue: '164', reference: '\\cf2'}
			]
		];

		function convertHtmlToRtf() {
			divHtml = $("#content").html();

			console.log(divHtml);
			for (divHtmlIndex = 0; divHtmlIndex < divHtml.length; divHtmlIndex++) {
				if (divHtml[divHtmlIndex] == '<') {
					doWhileIndexIsDifferentToWhiteSpaceAndBiggerThan();
					console.log(tagName);
					rtfStringContent += verifyTag(tagName);
					tagName = '';

					if (divHtml[divHtmlIndex] == ' ')
						ifExistWhiteSpaceBetweenTagAndTagOptions();
					else {
						if (divHtml[divHtmlIndex] == '>') 
							ifNotExistWhiteSpaceBetweenTagAndTagOptions();
					}
				}
			}
			generateRtfColorTable();

			rtfColorTableHead += rtfColorTableContent + '}';
			rtfStringHeader += rtfColorTableHead
			console.log('rtf => ', rtfStringContent);
			console.log('rtfStringHeader => ', rtfStringHeader);
			console.log('rtfStringFooter =>', rtfStringFooter);
			console.log('Final => \n', (rtfString += rtfStringHeader + rtfStringContent + rtfStringFooter));

		}

		function generateRtfColorTable() {
			var x = '';
			colorList[1].forEach(function(value){
				rtfColorTableContent += '\\red'+value.red+'\\green'+value.green+'\\blue'+value.blue+'; ';
			});
		}

		function addColorInColorList(r, g, b) {
			var exists = false;
			var colorTagReference;
			
			if(r != undefined && g != undefined && b != undefined) {
				colorList[1].forEach(function(value){
					if(value.red == r && value.green == g && value.blue == b) {
						exists = true;
						colorTagReference = value.reference;
					}
				});
				if(exists == false) {
					colorList[0]++;
					colorTagReference = '\\cf' + colorList[0] + ' ';
					colorList[1].push({red: r, green: g, blue: b, reference: colorTagReference});	

					console.log({red: r, green: g, blue: b, reference: colorTagReference});
					console.log(r, g, b, colorTagReference);
				}
			}
			else {
				colorTagReference = '';
			}
			return colorTagReference;
		}

		function ifNotExistWhiteSpaceBetweenTagAndTagOptions() {
			doWhileIndexIsDifferentToLessThanContent();
			console.log(tagContent);
			rtfStringContent += tagContent;
			tagContent = '';
			divHtmlIndex--;
		}

		function ifExistWhiteSpaceBetweenTagAndTagOptions() {
			doWhileIndexIsDifferentToBiggerThanOptions();

			if (divHtml[divHtmlIndex] == '>') {
				doWhileIndexIsDifferentToLessThan();

				console.log(tagContent);
				rtfStringContent += tagContent;
				tagContent = '';
				divHtmlIndex--;
			}			
		}

		function doWhileIndexIsDifferentToLessThanContent() {
			while (divHtml[divHtmlIndex] != '<' && divHtmlIndex < divHtml.length) {
				if (divHtml[divHtmlIndex] != '>') {
					tagContent += divHtml[divHtmlIndex];
				}
				divHtmlIndex++;
			}
		}

		function doWhileIndexIsDifferentToBiggerThanOptions() {
			while (divHtml[divHtmlIndex] != '>' && divHtmlIndex < divHtml.length) {
				tagOptions += divHtml[divHtmlIndex];
				divHtmlIndex++;
			}

			rtfStringContent += setStyles(tagOptions);
			
			console.log(tagOptions);
			tagOptions = '';
		}

		function setStyles(tagOptions) {
			var color = '';
			var colorList = [];
			var red = '';
			var green = '';
			var blue = '';
			var colorWithoutWhiteSpaces = '';
			var redRegex = new RegExp("rgb:(.*?);", "g");
			var regex = new RegExp("color:(.*?);", "g");

			var match;
			while ((match = regex.exec(tagOptions))) {
				color += match[1];
			}
			color = color.replace(/ /g, '');
			color = color.replace('rgb(', '');
			color = color.replace(')', '');

			colorList = color.split(',');
			red = colorList[0];
			green = colorList[1];
			blue = colorList[2];

			return addColorInColorList(red, green, blue);

		}

		function doWhileIndexIsDifferentToWhiteSpaceAndBiggerThan() {
			while (divHtml[divHtmlIndex] != ' ' && divHtml[divHtmlIndex] != '>' && divHtmlIndex < divHtml.length) {
				if (divHtml[divHtmlIndex] != '<') {
					tagName += divHtml[divHtmlIndex];
				}
				divHtmlIndex++;
			}
		}

		function doWhileIndexIsDifferentToLessThan() {
			while (divHtml[divHtmlIndex] != '<' && divHtmlIndex < divHtml.length) {
				if (divHtml[divHtmlIndex] != '>') {
					tagContent += divHtml[divHtmlIndex];
				}
				divHtmlIndex++;
			}
		}

		function verifyTag(tagName) {
			var listOfTags = [
				{ opening: 'p', openingRtf: '{\\pard ', closing: '/p', closingRtf: ' \\sb70 \\par}\n' },
				{ opening: 'b', openingRtf: '{\\b ', closing: '/b', closingRtf: ' }' },
				{ opening: 'i', openingRtf: '{\\i ', closing: '/i', closingRtf: ' }' },
				{ opening: 'br', openingRtf: ' \\line ', closing: '/br', closingRtf: ' \\line ' },
				{ opening: 'strong', openingRtf: '{\\b ', closing: '/strong', closingRtf: ' }' },
				{ opening: 'strong', openingRtf: '{\\b ', closing: '/strong', closingRtf: ' }' }
			];

			for(var i = 0; i<listOfTags.length; i++) {
				if(listOfTags[i].opening == tagName) 
					return listOfTags[i].openingRtf;

				if(listOfTags[i].closing == tagName)
					return listOfTags[i].closingRtf;
			}
			return '';
		}
	</script>
</head>

<body>
	<button onclick="convertHtmlToRtf()">Gerar RTF</button>

<div id="content">

<p style="font-size: 14.5pt;" class="no-margin"><strong>PARALISIA DE PREGA VOCAL</strong></p>

<p style="font-size: 14.5pt;" class="no-margin">Achados compatíveis com paralisia de prega vocal esquerda neste contexto clínico, caracterizados por redução volumétrica desta prega vocal com alargamento assimétrico do ventrículo laríngeo homolateral, leve rotação medial da cartilagem aritenóide esquerda, bem como deslocamento medial da prega ariepiglótica deste lado com dilatação do respectivo recesso piriforme.</p>

<p style="font-size: 14.5pt;" class="no-margin">Imagem compatível com aneurisma do arco aórtico, que poderá ser mais bem avaliado por estudo dirigido, a critério clínico.</p>

<p style="font-size: 14.5pt;" class="no-margin"><strong>PAPILOMATOSE</strong></p>

<p style="font-size: 14.5pt;" class="no-margin">Achados compatíveis com múltiplos pequenos pólipos junto à superfície das pregas vocais e vestibulares, determinando discreta redução luminal da laringe nestas topografias, determinando espessamento destas estruturas. Após administração endovenosa do meio de contraste iodado nota-se realce homogêneo destas formações polipóides. Este conjunto de achados não é específico, não sendo possível afastar a possibilidade de papilomatose laríngea, no contexto clínico apropriado. Também neste contexto, não é possível afastar a possibilidade de associação com lesão de natureza neoplásica.</p>

<p style="color: rgb(59, 0, 164);font-size: 14.5pt;" class="no-margin"><strong>TU PREGA VOCAL</strong></p>

<p style="font-size: 14.5pt;" class="no-margin">Pequena formação expansiva / infiltrativa acometendo o segmento anterior da prega vocal direita, com espessamento local e intenso realce predominantemente mucoso. Anteriormente a lesão estende-se à comissura anterior, com espessamento da mesma. Posteriormente a lesão não alcança a cartilagem aritenóide direita. Lateralmente não há extensão ao espaço paraglótico direito. Medialmente a lesão ultrapassa o plano mediano de forma incipiente, com extensão ao segmento mais ventral da prega vocal esquerda. Superiormente não apresenta extensão aparente ao segmento supraglótico da laringe e inferiormente não apresenta sinais de extensão subglótica. Mede cerca de 1,3 x 0,5 cm no plano axial.</p>

<p style="font-size: 14.5pt;" class="no-margin">O conjunto de achados acima mencionado não é específico, não sendo possível afastar a possibilidade de pequena lesão de natureza neoplásica, no contexto clínico apropriado.</p>

<p style="font-size: 14.5pt;" class="no-margin">Formação expansiva / infiltrativa com coeficientes de atenuação de partes moles com origem presumida na prega vocal esquerda, associada à esclerose e irregularidade da cartilagem aritenóide homolateral, que pode resultar de invasão tumoral.</p>

<p style="font-size: 14.5pt;" class="no-margin">Superiormente, estende-se pelo ventrículo laríngeo, prega vestibular e prega ariepiglótica à esquerda, obliterando a gordura do espaço paraglótico homolateral. Notam-se sinais de extensão para a epiglote, bem como oblitera a gordura pré-epiglótica com sinais de comprometimento da prega faringoepiglótica esquerda.</p>

<p style="font-size: 14.5pt;" class="no-margin">Inferiormente, estende-se à mucosa que reveste o segmento da laringe subglótica em sua parede anterolateral esquerda, até o nível da cartilagem cricóide, que se apresenta esclerótica em seu contorno posterior esquerdo podendo resultar de invasão ou processo inflamatório relacionado ao tumor. Não há sinais de extensão aos anéis traqueais.</p>

<p style="font-size: 14.5pt;" class="no-margin">Medialmente, acomete as comissuras anterior e posterior, com sinais de invasão das pregas vocal e vestibular direitas, determinando obliteração quase total da coluna aérea da laringe, com lúmen residual de 0,6 x 0,2 cm no plano axial.</p>

<p style="font-size: 14.5pt;" class="no-margin">Lateralmente, invade a lâmina esquerda da cartilagem tireóide, com sinais de comprometimento da musculatura estriada anterior do pescoço homolateral.</p>

<p style="font-size: 14.5pt;" class="no-margin">Anteriormente, invade a incisura e a porção anterior da lâmina direita da cartilagem tireóide, com sinais de comprometimento da musculatura cervical anterior infrahióidea.</p>

<p style="font-size: 14.5pt;" class="no-margin">Posteriormente, desloca medialmente a cartilagem aritenóide esquerda, bem como determina alargamento do espaço entre as cartilagens tireoide e aritenoide esquerdas, sem nítidos planos de clivagem com a musculatura cricofaríngea e com área pós-cricóide, porém sem sinais de comprometimento da musculatura pré-vertebral.</p>

<p style="font-size: 14.5pt;" class="no-margin">Após a administração endovenosa do meio de contraste iodado a lesão apresentou intenso realce heterogêneo.</p>

<p style="font-size: 14.5pt;" class="no-margin">O conjunto de achados acima mencionados é compatível com lesão neoplásica transglótica com maior eixo à esquerda.</p>

<p style="color: rgb(155, 44, 1);font-size: 14.5pt;" class="no-margin"><em><strong><u>TRAQUEOSTOMIA</u></strong></em></p>

<p style="font-size: 14.5pt;" class="no-margin">Traqueostomia com interposição de cânula.</p>

</div>

</body>

</html>